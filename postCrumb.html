<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <title>Gretl V1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <script>
        $(document).ready(() => {

            console.log('page ready?!')

            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyD6dLf9BkxgHhQbJ43z3O9V9-seJ3aN8y0",
                authDomain: "gretlv1-28308.firebaseapp.com",
                databaseURL: "https://gretlv1-28308.firebaseio.com",
                projectId: "gretlv1-28308",
                storageBucket: "gretlv1-28308.appspot.com",
                messagingSenderId: "882287762635"
            };

            firebase.initializeApp(config);
            let database = firebase.database();
            dbRef = database.ref('crumbs');
            // storageRef = firebase.storage();
            $('#postCrumbBtn').click(postCrumb);

            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    name = user.displayName;
                    firstname = name.split(' ')[0];
                    email = user.email;
                    photoURL = user.photoURL;
                    emailVerified = user.emailVerified;
                    uid = user.uid;
                } else { }
            });

            function postCrumb() {
                // var caption = document.getElementById('caption').value;
                // var selectedFile = document.getElementById('crumbUpload').files[0]
                // var imageName = selectedFile.name;
                // var storageRef = firebase.storage().ref('/crumbImages/' + imageName);
                // var uploadTask = storageRef.put(selectedFile);
                // uploadTask.on('state_changed', (snapshot) => {

                // }, (error) => {

                // }, () => {
                //     var downloadURL = uploadTask.snapshot.downloadURL;

                //     let rightNow = Date.now();
                //     //Generate random GPS. get GeoLoc later
                //     let geoLocation = {
                //         lat: getRandomInRange(30, 30.5, 4),
                //         lng: getRandomInRange(31, 31.5, 4)
                //     }

                //     let data = {
                //         time: rightNow,
                //         coords: geoLocation,
                //         user: name,
                //         img: downloadURL,
                //         caption: caption

                //     }
                //     dbRef.push(data);
                //     console.log('crumb Posted!')
                // })
                    console.log('posting on mobile??')
            }
        });

        function getRandomInRange(from, to, fixed) {
            return (Math.random() * (to - from) + from).toFixed(fixed) * 1;
            // .toFixed() returns string, so ' * 1' is a trick to convert to number
        }


    </script>
</head>

<body>

    <div data-role="page" data-dialog="true" id="postCrumbDialog" data-theme='a'>
        <div data-role='header' data-position='fixed'>
            <h1>Post a Crumb</h1>
        </div>
        <div data-role="main" class="ui-content">
            <img src="" alt="" id="crumbImagePreview">
            <input type="file" accept="image/*" capture="user" id="crumbUpload">
            <br>
            <label for='caption' class="ui-hidden-accessible">Caption Here</label>
            <input type="text" name="caption" id="caption" placeholder="Enter caption..">
            <a href="#" id='postCrumbBtn' class="ui-btn ui-icon-location ui-btn-icon-top ">Post!</a>
            <!-- <button id="postCrumbBtn">Post!</button> -->
        </div>
        <div data-role="footer">
            <!-- <a href="#" data-icon="alert" class="ui-btn-right">Feedback</a> -->
        </div>
    </div>

    </div>

    <!-- <script src="js/main.js"></script> -->
    <script type="text/javascript">
        // let uploadInput = $('#crumbUpload');
        // console.log(uploadInput);
        // uploadInput.change(() => {
        //     let curFiles = uploadInput.value;
        //     while (!uploadInput.value) {
        //         console.log('waiting');
        //     }
        //     console.log(uploadInput.value);
        //     console.log(curFiles);
        // })
        // // uploadInput.addEventListener('change', verifyCrumbImage);
        // function verifyCrumbImage(){
        //     let curFiles= uploadInput.files;
        //     console.log(curFiles);
        // }
    </script>
</body>

</html>